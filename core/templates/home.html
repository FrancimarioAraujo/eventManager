{% extends 'base.html' %}
{% load static %}
{% block 'head' %}
    <title> eventManager </title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel = "stylesheet" href = "{% static 'css/base.css' %}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel = "stylesheet" href = "{% static 'css/home.css' %}">
{% endblock 'head' %}

{% block 'content' %}

    <form action="{% url 'search_events' %}" method="get">
        <div id="search-bar">
            <img src = "{% static 'img/search.png' %}" alt = "Ícone de Pesquisa">
            <input type="text" name="q" placeholder="Pesquisar por eventos, shows, cursos, etc..." required>
        </div>
    </form>

    <div id="btn-location">
        <img src = "{% static 'img/localizacao.png' %}" alt = "Ícone de localização">
        <button id="local">Selecione uma localização</button>
    </div>

    <form id="locationForm" action="{% url 'search_location' %}" method="get">
        <div id="modal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>Localização</h2>
                <input type="text" id="searchInput" name="location" placeholder="Onde?">
                <ul id="locationList">
                    <li id="useCurrentLocation">Usar minha localização atual</li>
                </ul>
                <input type="hidden" id="latitudeInput" name="latitude">
                <input type="hidden" id="longitudeInput" name="longitude">
            </div>
        </div>
    </form>
    
    <script>
        var modal = document.getElementById('modal');
        var locationList = document.getElementById('locationList');
        var useCurrentLocation = document.getElementById('useCurrentLocation');

        var btn = document.getElementById('local');

        btn.onclick = function() {
        modal.style.display = 'block';
        };
    
        useCurrentLocation.onclick = function() {
            modal.style.display = 'none'; 
    
            // Verifica se o navegador suporta geolocalização
            if (navigator.geolocation) {
                // Obtém a localização atual do usuário
                navigator.geolocation.getCurrentPosition(function(position) {
                    var latitude = position.coords.latitude;
                    var longitude = position.coords.longitude;
    
                    document.getElementById('latitudeInput').value = latitude;
                    document.getElementById('longitudeInput').value = longitude;
    
                    var locationForm = document.getElementById('locationForm');
                    locationForm.submit();
                });
            } else {
                alert('Seu navegador não suporta geolocalização.');
            }
        };
    
    
        var span = document.getElementsByClassName('close')[0];
        span.onclick = function() {
        modal.style.display = 'none';
        };
 
        // Fecha o modal se o usuário clicar fora da área do modal
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = 'none';
        }
        };
    </script>

    {% if user.is_authenticated %}
        <div class="container">
            {% if query %}
                <h1 class="mt-4"> Eventos Disponíveis em {{query}} </h1>
            {% elif city %}
                <h1 class="mt-4"> Eventos Disponíveis em {{city}} </h1>
            {% elif state %}
                <h1 class="mt-4"> Eventos Disponíveis em {{state}} </h1>
            {% else %}
                <h1 class="mt-4"> Eventos Disponíveis </h1>
            {% endif %}
            <div class="row">
                {% for event in events %}
                    <div class="col-md-4">
                        <div class="card mb-4">
                            <img src="{{ event.image.url }}" class="card-img-top" alt="{{ event.name }}">
                            <div class="card-body">
                                <h5 class="card-title">{{ event.name }}</h5>
                                <h6 class="card-title">{{ event.date }}</h6>
                                <h6 class="card-title">{{ event.city }}, {{event.state}}</h6>
                                <a href="{% url 'viewEvent' event.id  %}"> <button id = "btn-detalhes"> Detalhes </button></a>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% else %}
        <main>    
            <div id = "banner">
                
            </div>

            <div id = "paragrafo">
                <p>
                    <span id = "destaque"> Planeje eventos de <br> sucesso com toda a</span> <br> Facilidade
                </p>
                <a href = "{% url 'register' %}"> <button> Seja um Promotor de Eventos </button> </a>
            </div>
        </main>
    {% endif %}
{% endblock 'content' %}